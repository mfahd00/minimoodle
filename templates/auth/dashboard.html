{% extends 'base.html' %}
{% load static %}
{% block title %}Dashboard | LAP{% endblock %}

{% block content %}
<div class="container py-4">

  <h2 class="mb-4 text-light fw-bold">Dashboard</h2>

  {% if is_instructor %}
    <h3 class="mb-4 fw-semibold text-light">Your Courses</h3>

    {% if courses %}
      <div class="row g-4">
        {% for course in courses %}
          <div class="col-md-6 col-lg-4">
            <div class="course-card h-100 p-4 d-flex flex-column">
              <h5 class="fw-bold text-info mb-2">
                <a href="{% url 'course_detail' course.id %}" class="text-decoration-none text-info">
                  {{ course.title }}
                </a>
              </h5>
              <p class="text-light small mb-3">
                {{ course.enrollment_set.count }} student{{ course.enrollment_set.count|pluralize }}
              </p>

              <div class="mt-auto d-flex justify-content-between">
                <a href="{% url 'edit_course' course.id %}" class="btn btn-sm btn-outline-light flex-grow-1 me-1">Edit</a>
                <a href="{% url 'delete_course' course.id %}" class="btn btn-sm btn-outline-danger flex-grow-1">Delete</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state text-center py-5">
        <p class="mb-3 text-muted">You haven’t created any courses yet.</p>
        <a href="{% url 'create_course' %}" class="btn btn-primary px-4 py-2 rounded-pill">+ Create a Course</a>
      </div>
    {% endif %}

  {% else %}
    <h3 class="mb-4 fw-semibold text-light">Your Enrolled Courses</h3>

    {% if enrollments %}
      <div class="row g-4">
        {% for enrollment in enrollments %}
          <div class="col-md-6 col-lg-4">
            <div class="course-card h-100 p-4 d-flex flex-column">
              <h5 class="fw-bold text-info mb-2">
                <a href="{% url 'course_detail' enrollment.course.id %}" class="text-decoration-none text-info">
                  {{ enrollment.course.title }}
                </a>
              </h5>

              {% if enrollment.course.category %}
                <p class="text-light small mb-1"><strong>Category:</strong> {{ enrollment.course.category.name }}</p>
              {% endif %}
              <p class="text-light small mb-3"><strong>Instructor:</strong> {{ enrollment.course.created_by.username }}</p>

              <div class="progress mb-2" style="height:16px;">
                <div class="progress-bar" role="progressbar"
                     style="width: {{ enrollment.progress }}%;"
                     aria-valuenow="{{ enrollment.progress }}"
                     aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <p class="text-light mb-3">{{ enrollment.progress }}% completed</p>

              <a href="{% url 'course_detail' enrollment.course.id %}" class="btn btn-outline-light mt-auto">Go to Course</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state text-center py-5">
        <p class="mb-3 text-muted">You haven’t enrolled in any courses yet.</p>
        <a href="{% url 'course_list' %}" class="btn btn-outline-primary px-4 py-2 rounded-pill">Browse Courses</a>
      </div>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
