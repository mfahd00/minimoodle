{% extends 'base.html' %}
{% block content %}
<h2>{{ course.title }}</h2>
<p>{{ course.description }}</p>

{% if user.is_authenticated %}
  {% if enrolled %}
    <p><strong>✅ You’re enrolled in this course.</strong></p>
  {% else %}
    <form action="{% url 'enroll_course' course.id %}" method="post">
      {% csrf_token %}
      <button type="submit">Enroll Now</button>
    </form>
  {% endif %}
{% else %}
  <p><a href="{% url 'login' %}?next={{ request.path }}">Login</a> to enroll.</p>
{% endif %}

{% if user.is_authenticated and user == course.created_by %}
  <p><a href="{% url 'create_lesson' course.id %}">➕ Add Lesson</a></p>
{% endif %}

<h3>Lessons</h3>
<ul>
  {% for lesson in lessons %}
    <li class="course-card">
      <strong>{{ lesson.title }}</strong><br>
      {{ lesson.content|truncatewords:25 }}
      {% if lesson.video_url %}
        <div><a href="{{ lesson.video_url }}" target="_blank" class="btn">Watch Video</a></div>
      {% endif %}
    </li>
  {% empty %}
    <p>No lessons yet.</p>
  {% endfor %}
</ul>
{% endblock %}
