{% extends 'base.html' %}
{% load humanize %}  
{% load custom_tags %}

{% block content %}
<div class="container py-5">



  <div class="overlay-box p-4 mb-5">
  <h2 class="section-heading mb-3">{{ course.title }}</h2>
  <p class="fs-5 mb-3">{{ course.description }}</p>

  <p class="mb-4 d-flex align-items-center flex-wrap gap-2">
  <strong>Category:</strong>
  {% if course.category %}
    <span class="badge badge-cat">{{ course.category.name }}</span>
  {% else %}
    <span class="badge badge-uncat">Uncategorized</span>
  {% endif %}

  {% if course.difficulty %}
    {% if course.difficulty == "beginner" %}
      <span class="badge badge-beg">Beginner</span>
    {% elif course.difficulty == "intermediate" %}
      <span class="badge badge-int">Intermediate</span>
    {% elif course.difficulty == "hard" %}
      <span class="badge badge-hard">Hard</span>
    {% endif %}
  {% endif %}
</p>


  {% if user.is_authenticated %}
    {% if user.profile.is_instructor %}
      {% if user == course.created_by %}
        <p class="fw-semibold section-heading">ğŸ‘©â€ğŸ« Youâ€™re the instructor for this course.</p>
      {% else %}
        <p class="fw-semibold section-heading">ğŸ‘¨â€ğŸ« Instructor of this course is: {{ course.created_by.username }}</p>
      {% endif %}
    {% else %}
      {% if enrolled %}
        <p class="fw-semibold text-success">âœ… Youâ€™re enrolled in this course.</p>
      {% else %}
        <form action="{% url 'enroll_course' course.id %}" method="post">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary px-4">Enroll Now</button>
        </form>
      {% endif %}
    {% endif %}
  {% else %}
    <p>
      <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-outline-info px-4">
        Login to Enroll
      </a>
    </p>
  {% endif %}


    {% if user.is_authenticated and user.profile.is_instructor and user == course.created_by %}
      <div class="d-flex flex-wrap gap-2 mt-3">
        <a href="{% url 'create_lesson' course.id %}" class="btn btn-outline-success">â• Add Lesson</a>
        <a href="{% url 'edit_course' course.id %}" class="btn btn-outline-warning">âœï¸ Edit</a>
        <a href="{% url 'delete_course' course.id %}" class="btn btn-outline-danger">ğŸ—‘ï¸ Delete</a>
      </div>
    {% endif %}
  </div>
  <div class="overlay-box p-4 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="section-heading fw-semibold section-heading mb-0"> ğŸ“¢ Announcements</h4>

      {% if user.is_authenticated and user.profile.is_instructor and user == course.created_by %}
        <a href="{% url 'create_announcement'%}" class="btn btn-outline-primary btn-sm">
          â• New Announcement
        </a>
      {% endif %}
    </div>

    {% if course.announcements.all %}
      {% for ann in course.announcements.all %}
        <div class=" mb-3 p-3 shadow-sm announcement-card">
          <h5 class="fw-bold section-subheading">{{ ann.title }}</h5>
          <p class="mb-2">{{ ann.message }}</p>
          <small class="">
            Posted {{ ann.created_at|naturaltime }} by {{ ann.created_by }}
          </small>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted mb-0">No announcements yet.</p>
    {% endif %}
  </div>

  
  <div class="overlay-box p-4 mb-4">
    <h4 class="section-heading mb-3">ğŸ“˜ Lessons</h4>
    {% if lessons %}
      <ul class="list-group list-group-flush">
        {% for lesson in lessons %}
          <li class="list-group-item bg-transparent border-0 border-bottom py-3 d-flex justify-content-between align-items-center flex-wrap">
            <div>
              <strong class="course-title">{{ lesson.title }}</strong><br>
              <small class="section-subheading">{{ lesson.content|truncatewords:25 }}</small>
            </div>
            {% if lesson.video_url %}
              <a href="{{ lesson.video_url }}" target="_blank" class="btn btn-outline-info btn-sm">ğŸ¥ Watch</a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mb-0">No lessons yet.</p>
    {% endif %}
  </div>

  <!-- ğŸ“ Assignments -->
  <div class="overlay-box p-4">
  <h4 class="section-heading mb-3">ğŸ“ Assignments</h4>
  {% if course.assignments.all %}
    <ul class="list-group list-group-flush">
      {% for assignment in course.assignments.all %}
        <li class="list-group-item bg-transparent border-0 border-bottom py-3 d-flex justify-content-between align-items-center flex-wrap">
          <div>
            <strong class="course-title">{{ assignment.title }}</strong><br>
            <small>Due: {{ assignment.due_date|date:"Y-m-d H:i" }}</small>
          </div>

          {% if user.is_authenticated %}
    {% if user.profile.is_instructor and user == course.created_by %}
        <a href="{% url 'view_submissions' assignment.id %}" class="btn btn-outline-secondary btn-sm">ğŸ“‚ View</a>
    {% elif user.profile.is_student %}
        {% if submissions|dict_get:assignment.id %}
            <button class="btn btn-sm" style="background: linear-gradient(135deg, #0a58ca, #084bb5); color: #fff; cursor: default;">âœ… Submitted</button>
        {% else %}
            <a href="{% url 'submit_assignment' assignment.id %}" class="btn btn-outline-info btn-sm">Submit</a>
        {% endif %}
    {% endif %}
{% endif %}

        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted mb-0">No assignments yet.</p>
  {% endif %}
</div>


  {% if user.is_authenticated and user.profile.is_instructor and user == course.created_by %}
    <div class="text-end mt-3">
      <a href="{% url 'create_assignment' course.id %}" class="btn btn-success">â• Add Assignment</a>
    </div>
  {% endif %}

</div>
{% endblock %}

{% block extra_css %}
<style>
.announcement-card {
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease;
}
.announcement-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
</style>
{% endblock %}
