{% extends 'base.html' %}
{% block content %}
<h2>{{ course.title }}</h2>
<p>{{ course.description }}</p>

<p><strong>Category:</strong>
  {% if course.category %}
    {{ course.category.name }}
  {% else %}
    Uncategorized
  {% endif %}
</p>

{% if user.is_authenticated %}
  {% if enrolled %}
    <p><strong>You’re enrolled in this course ✅.</strong></p>
  {% else %}
    <form action="{% url 'enroll_course' course.id %}" method="post">
      {% csrf_token %}
      <button type="submit" class="btn btn-success">Enroll Now</button>
    </form>
  {% endif %}
{% else %}
  <p><a href="{% url 'login' %}?next={{ request.path }}">Login</a> to enroll.</p>
{% endif %}

{% if user == course.created_by %}
  <a href="{% url 'create_lesson' course.id %}" class="btn btn-primary">➕ Add Lesson</a>
  <a href="{% url 'edit_course' course.id %}" class="btn btn-warning">✏️ Edit Course</a>
  <a href="{% url 'delete_course' course.id %}" class="btn btn-danger">🗑️ Delete Course</a>
{% endif %}

<hr>
<h3>Lessons</h3>
<ul>
  {% for lesson in lessons %}
    <li>
      <strong>{{ lesson.title }}</strong> - {{ lesson.content|truncatewords:25 }}
      {% if lesson.video_url %}
        <a href="{{ lesson.video_url }}" target="_blank" class="btn btn-sm btn-primary">Watch Video</a>
      {% endif %}
    </li>
  {% empty %}
    <p>No lessons yet.</p>
  {% endfor %}
</ul>

<hr>
<h3>Assignments</h3>
<ul>
  {% for assignment in course.assignments.all %}
    <li>
      <strong>{{ assignment.title }}</strong> - Due: {{ assignment.due_date|date:"Y-m-d H:i" }}
      {% if user.is_authenticated %}
        {% if user.profile.is_instructor and user == course.created_by %}
          <a href="{% url 'view_submissions' assignment.id %}" class="btn btn-sm btn-secondary">📂 View Submissions</a>
        {% else %}
          <a href="{% url 'submit_assignment' assignment.id %}" class="btn btn-sm btn-primary">Submit</a>
        {% endif %}
      {% endif %}
    </li>
  {% empty %}
    <p>No assignments yet.</p>
  {% endfor %}
</ul>

{% if user.is_authenticated and user.profile.is_instructor and user == course.created_by %}
  <a href="{% url 'create_assignment' course.id %}" class="btn btn-success mt-2">➕ Add Assignment</a>
{% endif %}

{% endblock %}
